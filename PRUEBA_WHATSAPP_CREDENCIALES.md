# ?? PRUEBA: ENVÍO AUTOMÁTICO DE WHATSAPP AL CREAR USUARIO

## ?? OBJETIVO DE LA PRUEBA

Verificar que al crear un usuario para un cliente, el sistema:
1. ? Genere credenciales automáticamente (DNI + contraseña de 6 dígitos)
2. ? Muestre las credenciales al administrador
3. ? Pregunte si desea enviar por WhatsApp
4. ? Abra WhatsApp con mensaje prellenado
5. ? Permita enviar el mensaje al cliente

---

## ?? PREREQUISITOS

### 1. Datos de Prueba Necesarios:
- ? Cliente registrado en el sistema
- ? Cliente NO debe tener usuario creado previamente
- ? Cliente debe tener número de teléfono válido

### 2. Teléfono del Cliente:
Formatos aceptados por el sistema:
- `0424-123-4567` ? Se convierte a `584241234567`
- `424-123-4567` ? Se convierte a `584241234567`
- `58424123456 7` ? Se mantiene como `584241234567`

---

## ?? PASOS DE LA PRUEBA

### PASO 1: Crear Cliente de Prueba

```
1. Login como admin (admin/admin123)
2. Dashboard ? Menú ? Clientes
3. Click botón "+" (Agregar Cliente)
4. Llenar formulario:
   ??????????????????????????????????????
   ?  Nombre: Juan Pérez Test          ?
   ?  DNI: 12345678                     ?
   ?  Teléfono: 0424-999-8888          ? ? IMPORTANTE: Tu número real
   ?  Dirección: Calle Principal 123   ?
   ?  [GUARDAR]                         ?
   ??????????????????????????????????????
5. ? Verificar mensaje: "Cliente guardado correctamente"
```

**?? Resultado Esperado:**
- Cliente "Juan Pérez Test" aparece en la lista
- DNI: 12345678
- Teléfono: 0424-999-8888

---

### PASO 2: Ir a Gestionar Usuarios

```
1. Desde Dashboard
2. Abrir menú hamburguesa (?)
3. Buscar opción "Gestionar Usuarios"
4. Click en "Gestionar Usuarios"
```

**?? Resultado Esperado:**
- Se abre página "Gestionar Usuarios"
- Se ven 3 secciones:
  • Solicitudes Pendientes (vacío)
  • Crear Usuario para Cliente
  • Usuarios Activos

---

### PASO 3: Crear Usuario para el Cliente

```
1. Scroll hasta sección "?? Crear Usuario para Cliente"
2. Leer mensaje informativo:
   ??????????????????????????????????????????
   ? ?? El usuario será el DNI del cliente ?
   ? y se generará una contraseña de       ?
   ? 6 dígitos automáticamente             ?
   ??????????????????????????????????????????
3. Click en Picker "Seleccione un cliente"
4. Seleccionar: "Juan Pérez Test"
   ??????????????????????????????????????
   ? ? Juan Pérez Test                 ? ? Click aquí
   ??????????????????????????????????????
5. Click botón "?? GENERAR CREDENCIALES"
```

**?? Resultado Esperado:**
- Cliente "Juan Pérez Test" visible en picker
- Botón morado con texto "?? GENERAR CREDENCIALES"

---

### PASO 4: Sistema Genera Credenciales

```
Sistema procesa y muestra diálogo:

????????????????????????????????????????????
?  ? Usuario Creado                       ?
????????????????????????????????????????????
?  Usuario creado para: Juan Pérez Test   ?
?                                          ?
?  ?? Usuario (DNI): 12345678              ?
?  ?? Contraseña: 847392                   ? ? ANOTAR ESTA CONTRASEÑA
?                                          ?
?  ¿Deseas enviar las credenciales         ?
?  por WhatsApp ahora?                     ?
?                                          ?
?  [Sí, enviar WhatsApp] [No, solo copiar]?
????????????????????????????????????????????
```

**?? Resultado Esperado:**
- Usuario: 12345678 (DNI del cliente)
- Contraseña: 6 dígitos aleatorios (ejemplo: 847392)
- Dos opciones claras

**?? ANOTAR:**
```
Usuario: 12345678
Contraseña: ________ (la que aparezca)
```

---

### PASO 5A: Probar Envío de WhatsApp

```
1. Click botón "Sí, enviar WhatsApp"
2. ? Sistema procesa...
3. Se abre WhatsApp (aplicación o web)
```

**?? Resultado Esperado:**
WhatsApp se abre con mensaje prellenado:

```
??????????????????????????????????????????
?  WhatsApp                              ?
?  Para: 58424-999-8888                  ?
??????????????????????????????????????????
?  ¡Bienvenido a CrediVnzl! ??          ?
?                                        ?
?  Tu cuenta ha sido creada              ?
?  exitosamente.                         ?
?                                        ?
?  ?? *Tus credenciales de acceso:*      ?
?  Usuario: *12345678* (tu DNI)          ?
?  Contraseña: *847392*                  ?
?                                        ?
?  ?? Descarga la app y accede con       ?
?  estas credenciales.                   ?
?                                        ?
?  ?? Por seguridad, te recomendamos     ?
?  cambiar tu contraseña desde la        ?
?  opción 'Mi Cuenta' en la app.         ?
?                                        ?
?  ¡Gracias por confiar en nosotros!     ?
?                                        ?
?  [Enviar]                              ?
??????????????????????????????????????????
```

**? VERIFICACIONES:**
- [x] Número de teléfono correcto (58424-999-8888)
- [x] Mensaje completo y formateado
- [x] DNI correcto (12345678)
- [x] Contraseña visible y correcta
- [x] Texto en negrita (*...*) se ve bien
- [x] Emojis se muestran correctamente

---

### PASO 5B: Enviar el Mensaje

```
1. En WhatsApp, click botón "Enviar"
2. ? Mensaje se envía al contacto
3. Regresar a la app
```

**?? Resultado Esperado:**
Diálogo de confirmación:

```
????????????????????????????????????????????
?  WhatsApp Enviado                        ?
????????????????????????????????????????????
?  Se ha abierto WhatsApp con el mensaje   ?
?  de credenciales. Por favor, envíalo     ?
?  al cliente.                             ?
?                                          ?
?  [OK]                                    ?
????????????????????????????????????????????
```

---

### PASO 6: Verificar Usuario Creado

```
1. Click "OK" en el diálogo
2. Página se actualiza automáticamente
3. Scroll hasta "?? Usuarios Activos"
4. Buscar el usuario creado:
   ??????????????????????????????????????
   ?  Juan Pérez Test                   ?
   ?  ?? Usuario: 12345678              ?
   ?  ?? 0424-999-8888                  ?
   ?  ? Último acceso: --/--/---- --:--?
   ?                                    ?
   ?  [?? Nueva Password] [? Desactivar]?
   ??????????????????????????????????????
```

**? VERIFICACIONES:**
- [x] Usuario aparece en "Usuarios Activos"
- [x] Nombre correcto: "Juan Pérez Test"
- [x] Usuario correcto: "12345678"
- [x] Teléfono correcto: "0424-999-8888"
- [x] Botones disponibles: "?? Nueva Password" y "? Desactivar"

---

### PASO 7: Verificar Cliente Ya No Aparece en Picker

```
1. Scroll hasta "?? Crear Usuario para Cliente"
2. Click en Picker "Seleccione un cliente"
3. Verificar que "Juan Pérez Test" NO aparece
```

**?? Resultado Esperado:**
- Cliente "Juan Pérez Test" ya no está en el picker
- Solo aparecen clientes sin usuario
- Sistema evita crear usuarios duplicados

---

## ?? PRUEBA ALTERNATIVA: Opción "No, solo copiar"

### PASO ALT-1: Repetir PASOS 1-4 con otro cliente

```
Crear nuevo cliente:
  Nombre: María García Test
  DNI: 87654321
  Teléfono: 0414-888-7777
  Dirección: Av. Principal 456
```

### PASO ALT-2: Generar Credenciales

```
1. Seleccionar "María García Test"
2. Click "?? GENERAR CREDENCIALES"
3. Ver diálogo con credenciales
4. Click "No, solo copiar"
```

**?? Resultado Esperado:**
Diálogo alternativo:

```
????????????????????????????????????????????
?  Credenciales Generadas                  ?
????????????????????????????????????????????
?  Usuario: 87654321                       ?
?  Contraseña: 192847                      ?
?                                          ?
?  Comunica estas credenciales al cliente. ?
?                                          ?
?  [OK]                                    ?
????????????????????????????????????????????
```

**? VERIFICACIONES:**
- [x] No se abre WhatsApp
- [x] Credenciales mostradas claramente
- [x] Admin puede copiar manualmente
- [x] Usuario se crea igual

---

## ?? PRUEBA DE VALIDACIONES

### Validación 1: Cliente sin Teléfono

```
1. Crear cliente sin teléfono
2. Intentar crear usuario
3. Seleccionar ese cliente
4. Click "?? GENERAR CREDENCIALES"
5. Elegir "Sí, enviar WhatsApp"
```

**?? Resultado Esperado:**
```
????????????????????????????????????????????
?  Error                                   ?
????????????????????????????????????????????
?  No se pudo abrir WhatsApp.              ?
?  Verifica el número de teléfono          ?
?  del cliente.                            ?
?                                          ?
?  [OK]                                    ?
????????????????????????????????????????????
```

### Validación 2: Cliente sin Seleccionar

```
1. Ir a "Crear Usuario para Cliente"
2. No seleccionar ningún cliente
3. Click "?? GENERAR CREDENCIALES"
```

**?? Resultado Esperado:**
```
????????????????????????????????????????????
?  Error                                   ?
????????????????????????????????????????????
?  Seleccione un cliente                   ?
?                                          ?
?  [OK]                                    ?
????????????????????????????????????????????
```

### Validación 3: Cliente con Usuario Existente

```
1. Crear cliente "Pedro Test"
2. Crear usuario para "Pedro Test"
3. Intentar crear usuario nuevamente para "Pedro Test"
```

**?? Resultado Esperado:**
- "Pedro Test" no aparece en el picker
- Sistema previene duplicados

---

## ?? PRUEBA FINAL: Login del Cliente

### PASO 1: Cerrar Sesión de Admin

```
1. Menú hamburguesa
2. Click "Cerrar Sesión"
3. Volver a BienvenidaPage
```

### PASO 2: Intentar Login como Cliente

```
1. Click en opción "Cliente"
2. Se abre LoginClientePage (azul)
3. Ingresar credenciales:
   ??????????????????????????????????????
   ?  DNI (Documento de Identidad)      ?
   ?  [12345678]                        ?
   ?                                    ?
   ?  Contraseña                        ?
   ?  [847392]  ? La que recibió        ?
   ?                                    ?
   ?  [CONSULTAR MI PRÉSTAMO]           ?
   ??????????????????????????????????????
4. Click "CONSULTAR MI PRÉSTAMO"
```

**?? Resultado Esperado:**
- ? Login exitoso
- ? Navega a DashboardClientePage
- ? Cliente puede ver su información
- ? Credenciales funcionan correctamente

---

## ? CHECKLIST COMPLETO DE PRUEBA

### Funcionalidades Principales:
- [ ] Cliente se crea correctamente
- [ ] Usuario se genera con DNI como username
- [ ] Contraseña de 6 dígitos se genera
- [ ] Diálogo muestra credenciales claramente
- [ ] Opción "Sí, enviar WhatsApp" funciona
- [ ] WhatsApp se abre con mensaje prellenado
- [ ] Mensaje tiene formato correcto
- [ ] Número de teléfono se formatea bien
- [ ] Mensaje se puede enviar desde WhatsApp
- [ ] Opción "No, solo copiar" funciona
- [ ] Usuario aparece en "Usuarios Activos"
- [ ] Cliente desaparece del picker
- [ ] Login con credenciales funciona

### Validaciones:
- [ ] Error si no se selecciona cliente
- [ ] Error si teléfono inválido
- [ ] No permite usuarios duplicados
- [ ] Cliente con usuario no aparece en picker

### Interfaz:
- [ ] Mensaje WhatsApp bien formateado
- [ ] Emojis se muestran correctamente
- [ ] Texto en negrita funciona
- [ ] Diálogos claros y entendibles
- [ ] Botones funcionan correctamente

---

## ?? RESULTADOS ESPERADOS

### ? PRUEBA EXITOSA SI:
1. Cliente recibe mensaje de WhatsApp con credenciales
2. Credenciales son correctas (DNI + 6 dígitos)
3. Cliente puede hacer login con esas credenciales
4. WhatsApp se abre automáticamente con mensaje prellenado
5. Mensaje tiene formato profesional y legible
6. Sistema previene errores (validaciones funcionan)

### ? PRUEBA FALLIDA SI:
1. WhatsApp no se abre
2. Mensaje no se prellenado
3. Credenciales incorrectas en el mensaje
4. Login falla con las credenciales
5. Usuario no aparece en "Usuarios Activos"
6. Cliente aún aparece en el picker después de crear usuario

---

## ?? SOLUCIÓN DE PROBLEMAS

### Problema 1: WhatsApp no se abre
**Posibles causas:**
- WhatsApp no instalado en el dispositivo
- Número de teléfono inválido
- Permisos de la app

**Solución:**
- Verificar que WhatsApp esté instalado
- Verificar formato del número: 58XXXXXXXXXX
- Probar con "No, solo copiar"

### Problema 2: Mensaje no prellenado
**Posibles causas:**
- Caracteres especiales en el mensaje
- Codificación de URL incorrecta

**Solución:**
- Verificar que el mensaje se codifique correctamente
- Usar `Uri.EscapeDataString()` en WhatsAppService

### Problema 3: Contraseña no funciona
**Posibles causas:**
- Contraseña mal copiada
- Usuario no creado en BD

**Solución:**
- Copiar contraseña exactamente como aparece
- Verificar que usuario esté en "Usuarios Activos"
- Usar opción "?? Nueva Password" si es necesario

---

## ?? NOTAS IMPORTANTES

### ?? Seguridad:
- Contraseñas son de 6 dígitos numéricos
- Se recomienda al cliente cambiar su contraseña
- Contraseñas se hashean antes de guardar en BD

### ?? WhatsApp:
- Sistema usa API de WhatsApp Web: `https://wa.me/`
- Funciona en móvil y desktop
- Requiere WhatsApp instalado
- Abre en navegador si no está instalado

### ?? Formato de Teléfono:
- Sistema convierte automáticamente formato venezolano
- 0424XXXXXXX ? 58424XXXXXXX
- 424XXXXXXX ? 58424XXXXXXX
- +58424XXXXXXX ? 58424XXXXXXX

---

## ?? PRUEBA COMPLETADA

Fecha: _______________
Probado por: _______________
Resultado: ? EXITOSO  ? FALLIDO

**Observaciones:**
_________________________________________________
_________________________________________________
_________________________________________________

**Evidencias (Screenshots):**
- [ ] Diálogo de credenciales generadas
- [ ] WhatsApp con mensaje prellenado
- [ ] Usuario en "Usuarios Activos"
- [ ] Login exitoso del cliente

---

¿Encontraste algún problema durante la prueba? ¡Documéntalo para poder corregirlo!
