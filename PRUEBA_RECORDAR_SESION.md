# ?? GUÍA DE PRUEBA: FUNCIONALIDAD "RECORDAR SESIÓN"

## ?? OBJETIVO

Verificar que la funcionalidad "Recordar sesión" del login de administrador funcione correctamente en todos los escenarios posibles.

---

## ?? PREREQUISITOS

- ? Aplicación compilada y ejecutándose
- ? Usuario admin configurado (admin/admin123)
- ? Base de datos inicializada
- ? Visual Studio con Output activado para ver logs

---

## ?? PRUEBA 1: LOGIN CON "RECORDAR SESIÓN" ACTIVADO

### PASO 1.1: Estado Inicial

```
1. Asegurarse de que la app esté cerrada completamente
2. Si es necesario, desinstalar y reinstalar la app
3. Abrir Visual Studio Output para ver logs
```

**?? Resultado Esperado:**
- App cerrada completamente
- No hay sesión activa

---

### PASO 1.2: Hacer Login con "Recordar sesión"

```
1. Ejecutar la app (F5)
2. En página de Bienvenida:
   ??????????????????????????????????????
   ?      [Logo CrediVzla]              ?
   ?                                    ?
   ?  ?? Administrador                  ? ? Click aquí
   ?  ?? Cliente                        ?
   ??????????????????????????????????????

3. En LoginAdminPage:
   ??????????????????????????????????????
   ?  Usuario: [admin]                  ?
   ?  Contraseña: [admin123]            ?
   ?  ? Recordar mis datos              ? ? MARCAR
   ?                                    ?
   ?  [INGRESAR AL SISTEMA]             ?
   ??????????????????????????????????????

4. Click "INGRESAR AL SISTEMA"
```

**?? Resultado Esperado:**
```
En Output de Visual Studio:
*** Login exitoso para: admin (Rol: Admin) ***
*** RecordarMe está: True ***
*** Guardando credenciales en Preferences ***
*** Navegación post-login completada ***

En la app:
? Login exitoso
? Navega al Dashboard del Administrador
```

---

### PASO 1.3: Verificar Preferences Guardadas

```
En el código (o con debugging), verificar:
Preferences.Get("recordar_usuario", false) == true
Preferences.Get("ultimo_usuario", "") == "admin"
```

**? VERIFICACIONES:**
- [x] `recordar_usuario` = true
- [x] `ultimo_usuario` = "admin"
- [x] Dashboard cargado correctamente

---

### PASO 1.4: Cerrar y Reabrir la App (Login Automático)

```
1. Detener la app (Shift+F5 en Visual Studio)
2. Esperar 2 segundos
3. Ejecutar la app nuevamente (F5)
4. Observar comportamiento
```

**?? Resultado Esperado:**

```
En Output de Visual Studio:
??????????????????????????????????????????????????
?        FLUJO DE INICIO DE APLICACIÓN          ?
??????????????????????????????????????????????????
? Recordar credenciales: True
? Último usuario guardado: 'admin'

?? SÍ tiene 'Recordar credenciales' ??
? Intentando login automático...     ?
??????????????????????????????????????

?? Usuario VÁLIDO y ACTIVO ??
? Usuario: admin
? Rol: Admin
? Estado: Activo
?????????????????????????????

? Usuario establecido en AuthService
? Último acceso actualizado

? Navegando a: //dashboard (Administrador)

? Login automático completado exitosamente

En la app:
? NO muestra página de Bienvenida
? NO muestra LoginPage
? Va DIRECTO al Dashboard
? Usuario ya está logueado
```

**? VERIFICACIONES:**
- [x] Login automático funciona
- [x] NO pide credenciales
- [x] Va directo al Dashboard
- [x] Usuario autenticado correctamente

---

## ?? PRUEBA 2: LOGIN SIN "RECORDAR SESIÓN"

### PASO 2.1: Limpiar Preferences

```
1. En el Dashboard, abrir menú hamburguesa (?)
2. Click "Cerrar Sesión"
3. Confirmar
```

**?? Resultado Esperado:**
```
En Output:
*** Usuario confirmó cerrar sesión ***
*** Limpiando preferences de login automático ***

En la app:
? Regresa a página de Bienvenida
? Preferences limpiadas
```

---

### PASO 2.2: Login sin "Recordar sesión"

```
1. En página de Bienvenida, click "Administrador"
2. En LoginAdminPage:
   ??????????????????????????????????????
   ?  Usuario: [admin]                  ?
   ?  Contraseña: [admin123]            ?
   ?  ? Recordar mis datos              ? ? NO MARCAR
   ?                                    ?
   ?  [INGRESAR AL SISTEMA]             ?
   ??????????????????????????????????????

3. Click "INGRESAR AL SISTEMA"
```

**?? Resultado Esperado:**
```
En Output:
*** Login exitoso para: admin (Rol: Admin) ***
*** RecordarMe está: False ***
*** Limpiando credenciales de Preferences ***

En la app:
? Login exitoso
? Navega al Dashboard
? Preferences NO guardadas
```

---

### PASO 2.3: Cerrar y Reabrir (NO hace login automático)

```
1. Detener la app (Shift+F5)
2. Esperar 2 segundos
3. Ejecutar la app nuevamente (F5)
```

**?? Resultado Esperado:**

```
En Output:
??????????????????????????????????????????????????
?        FLUJO DE INICIO DE APLICACIÓN          ?
??????????????????????????????????????????????????
? Recordar credenciales: False
? Último usuario guardado: ''

?? NO tiene 'Recordar credenciales' ??
? Comportamiento normal               ?
???????????????????????????????????????

? Navegando a: //bienvenida

En la app:
? Va a página de Bienvenida
? NO hace login automático
? Usuario debe hacer login manualmente
```

**? VERIFICACIONES:**
- [x] NO hace login automático
- [x] Muestra página de Bienvenida
- [x] Preferences NO tienen credenciales

---

## ?? PRUEBA 3: CERRAR SESIÓN MANUAL (Limpia Preferences)

### PASO 3.1: Login con "Recordar sesión" activado

```
1. Página de Bienvenida ? "Administrador"
2. Usuario: admin
3. Contraseña: admin123
4. ? Marcar "Recordar mis datos"
5. Click "INGRESAR"
```

**?? Resultado Esperado:**
- Login exitoso
- Preferences guardadas

---

### PASO 3.2: Cerrar Sesión Manualmente

```
1. En Dashboard, abrir menú hamburguesa (?)
2. Scroll hasta el final
3. Click "Cerrar Sesión"
4. Confirmar en el diálogo:
   ??????????????????????????????????????
   ?  Cerrar Sesión                     ?
   ??????????????????????????????????????
   ?  ¿Estás seguro que deseas cerrar   ?
   ?  sesión?                           ?
   ?                                    ?
   ?  [Sí, cerrar sesión] [Cancelar]    ?
   ??????????????????????????????????????
5. Click "Sí, cerrar sesión"
```

**?? Resultado Esperado:**

```
En Output:
*** OnCerrarSesionClicked - Iniciando ***
*** Usuario respondió: True ***
*** Usuario confirmó cerrar sesión ***
*** Sesión cerrada en AuthService ***
*** Limpiando preferences de login automático ***
Preferences.Remove("recordar_usuario")
Preferences.Remove("ultimo_usuario")
*** Preferences limpiadas correctamente ***
*** MainPage cambiada exitosamente ***

En la app:
? Sesión cerrada
? Regresa a página de Bienvenida
? Preferences limpiadas
```

---

### PASO 3.3: Verificar que Preferences están limpias

```
1. Cerrar la app (Shift+F5)
2. Abrir la app (F5)
```

**?? Resultado Esperado:**
```
En la app:
? Va a página de Bienvenida
? NO hace login automático
? Debe hacer login manualmente

Esto confirma que las preferences se limpiaron correctamente
```

**? VERIFICACIONES:**
- [x] Cerrar sesión limpia preferences
- [x] Próxima apertura NO hace login automático
- [x] Comportamiento correcto

---

## ?? PRUEBA 4: CAMPOS PRELLENADOS AL VOLVER AL LOGIN

### PASO 4.1: Login con "Recordar sesión"

```
1. Página de Bienvenida ? "Administrador"
2. Usuario: admin
3. Contraseña: admin123
4. ? Marcar "Recordar mis datos"
5. Click "INGRESAR"
```

---

### PASO 4.2: Volver al Login (sin cerrar sesión)

```
1. En el Dashboard, usar el botón "? Regresar"
   O
   Navegar a la página de login manualmente
```

**?? Resultado Esperado:**

```
En Output:
?????????????????????????????????????????????????
?  CARGANDO CREDENCIALES GUARDADAS              ?
?????????????????????????????????????????????????
? Recordar usuario: True
? Último usuario guardado: 'admin'
? Usuario y CheckBox cargados correctamente
?????????????????????????????????????????????????

En LoginAdminPage:
??????????????????????????????????????
?  Usuario: [admin]                  ? ? PRELLENADO
?  Contraseña: [        ]            ? ? VACÍO
?  ? Recordar mis datos              ? ? MARCADO
?                                    ?
?  [INGRESAR AL SISTEMA]             ?
??????????????????????????????????????
```

**? VERIFICACIONES:**
- [x] Campo "Usuario" prellenado con "admin"
- [x] Campo "Contraseña" vacío (por seguridad)
- [x] CheckBox "Recordar mis datos" marcado
- [x] Usuario solo necesita ingresar contraseña

---

## ?? PRUEBA 5: USUARIO DESACTIVADO (Validación de Seguridad)

### PASO 5.1: Setup

```
1. Login con "Recordar sesión" activado
2. Verificar que funciona el login automático
3. Cerrar la app
```

---

### PASO 5.2: Desactivar Usuario en BD

```
En el código (DatabaseService o directamente en BD):
1. Buscar usuario "admin"
2. Establecer:
   usuario.Activo = false
   O
   usuario.Estado = EstadosUsuario.Inactivo
3. Guardar cambios
```

---

### PASO 5.3: Abrir la App

```
1. Ejecutar la app (F5)
2. Observar comportamiento
```

**?? Resultado Esperado:**

```
En Output:
??????????????????????????????????????????????????
?        FLUJO DE INICIO DE APLICACIÓN          ?
??????????????????????????????????????????????????
? Recordar credenciales: True
? Último usuario guardado: 'admin'

?? Usuario NO VÁLIDO ??
? Razón: Usuario inactivo (Activo=False)
??????????????????????

? Limpiando preferences...
? Navegando a: //bienvenida

En la app:
? Detecta usuario inválido
? Limpia preferences automáticamente
? Va a página de Bienvenida
? NO hace login automático
```

**? VERIFICACIONES:**
- [x] Sistema detecta usuario inválido
- [x] Preferences se limpian automáticamente
- [x] Va a página de Bienvenida
- [x] Validación de seguridad funciona

---

### PASO 5.4: Reactivar Usuario

```
1. Reactivar usuario en BD:
   usuario.Activo = true
   usuario.Estado = EstadosUsuario.Activo
2. Guardar cambios
```

---

## ?? PRUEBA 6: CAMBIO DE CheckBox EN TIEMPO REAL

### PASO 6.1: Login con CheckBox desmarcado

```
1. Página de Bienvenida ? "Administrador"
2. Usuario: admin
3. Contraseña: admin123
4. ? NO marcar "Recordar mis datos"
5. Click "INGRESAR"
```

**Verificar:**
- Preferences NO guardadas

---

### PASO 6.2: Regresar al Login y Marcar CheckBox

```
1. Regresar a LoginAdminPage
2. Verificar que CheckBox esté DESMARCADO
3. Usuario: admin (ya está prellenado)
4. Contraseña: admin123
5. ? MARCAR "Recordar mis datos"
6. Click "INGRESAR"
```

**?? Resultado Esperado:**
```
En Output:
*** RecordarMe está: True ***
*** Guardando credenciales en Preferences ***

Ahora sí se guardan las preferences
```

---

### PASO 6.3: Verificar Login Automático

```
1. Cerrar app
2. Abrir app
```

**?? Resultado Esperado:**
- ? Hace login automático
- ? Va directo al Dashboard

---

## ?? PRUEBA 7: MÚLTIPLES CIERRES Y APERTURAS

### Escenario: Abrir y cerrar la app varias veces

```
1. Login con "Recordar sesión" ?
2. Cerrar app
3. Abrir app ? ? Login automático
4. Cerrar app
5. Abrir app ? ? Login automático
6. Cerrar app
7. Abrir app ? ? Login automático
```

**? VERIFICACIONES:**
- [x] Login automático funciona consistentemente
- [x] No hay errores en múltiples aperturas
- [x] Preferences se mantienen

---

## ?? PRUEBA 8: CERRAR SESIÓN Y VOLVER A ACTIVAR

```
1. Login con "Recordar sesión" ?
2. Verificar login automático funciona
3. Cerrar sesión manualmente
4. Login nuevamente con "Recordar sesión" ?
5. Cerrar app
6. Abrir app
```

**?? Resultado Esperado:**
- ? Login automático funciona nuevamente
- ? Preferences se guardan correctamente

---

## ? CHECKLIST COMPLETO DE PRUEBAS

### Funcionalidad Básica:
- [ ] CheckBox "Recordar mis datos" existe en LoginAdminPage
- [ ] CheckBox se marca/desmarca correctamente
- [ ] Login con CheckBox marcado guarda preferences
- [ ] Login con CheckBox desmarcado NO guarda preferences
- [ ] Login automático funciona cuando hay preferences
- [ ] Login automático NO funciona cuando no hay preferences

### Persistencia:
- [ ] Preferences se guardan correctamente en login
- [ ] Preferences persisten al cerrar y abrir app
- [ ] Preferences se limpian al cerrar sesión manual
- [ ] Preferences se limpian si usuario no es válido

### Interfaz:
- [ ] Campo "Usuario" se prellena cuando hay preferences
- [ ] CheckBox aparece marcado cuando hay preferences
- [ ] Campo "Contraseña" siempre está vacío
- [ ] Comportamiento visual es correcto

### Validaciones de Seguridad:
- [ ] Usuario inactivo NO puede hacer login automático
- [ ] Usuario con estado inválido NO puede hacer login automático
- [ ] Usuario sin rol válido NO puede hacer login automático
- [ ] Preferences se limpian si validaciones fallan

### Navegación:
- [ ] Login automático navega a Dashboard (Admin)
- [ ] Login automático navega a DashboardCliente (Cliente)
- [ ] Sin preferences navega a Bienvenida
- [ ] Usuario inválido navega a Bienvenida

### Logs:
- [ ] Logs muestran estado de "Recordar credenciales"
- [ ] Logs muestran cuando se guardan preferences
- [ ] Logs muestran cuando se limpian preferences
- [ ] Logs muestran validaciones de usuario

---

## ?? RESULTADOS ESPERADOS

### ? PRUEBA EXITOSA SI:

1. **Login con "Recordar sesión" activado:**
   - Preferences se guardan
   - Próxima apertura hace login automático
   - Va directo al Dashboard

2. **Login sin "Recordar sesión":**
   - Preferences NO se guardan
   - Próxima apertura va a Bienvenida
   - Debe hacer login manual

3. **Cerrar sesión manual:**
   - Preferences se limpian SIEMPRE
   - Próxima apertura va a Bienvenida
   - NO hace login automático

4. **Campos prellenados:**
   - Usuario aparece prellenado
   - CheckBox aparece marcado
   - Contraseña siempre vacía

5. **Validaciones de seguridad:**
   - Usuario inactivo rechazado
   - Preferences se limpian automáticamente
   - Sistema es seguro

---

### ? PRUEBA FALLIDA SI:

1. CheckBox no se marca/desmarca
2. Preferences no se guardan
3. Login automático no funciona
4. Preferences no se limpian al cerrar sesión
5. Campos no se prellenan correctamente
6. Usuario inactivo puede hacer login automático
7. Hay errores en logs

---

## ?? SOLUCIÓN DE PROBLEMAS

### Problema: Login automático no funciona

**Verificar:**
1. Preferences se guardan en login
2. Método `CargarCredencialesGuardadas()` se llama en `OnAppearing()`
3. Validación de usuario en `App.xaml.cs` es correcta

---

### Problema: CheckBox no se marca al volver

**Verificar:**
1. `CargarCredencialesGuardadas()` establece `RecordarMe = true`
2. Binding en XAML es correcto: `IsChecked="{Binding RecordarMe}"`
3. PropertyChanged se dispara correctamente

---

### Problema: Preferences no se limpian

**Verificar:**
1. Código en `AppShell.xaml.cs` ejecuta `Preferences.Remove()`
2. Código se ejecuta al confirmar cerrar sesión
3. No hay excepciones en logs

---

## ?? REPORTE DE PRUEBA

### Plantilla:

```
???????????????????????????????????????????
REPORTE DE PRUEBA: RECORDAR SESIÓN
???????????????????????????????????????????

Fecha: _______________
Probado por: _______________
Dispositivo/Emulador: _______________

???????????????????????????????????????????
PRUEBA 1: Login con "Recordar sesión" ?
???????????????????????????????????????????
? Preferences guardadas
? Login automático funciona
? Va directo al Dashboard
Observaciones: _________________________

???????????????????????????????????????????
PRUEBA 2: Login sin "Recordar sesión"
???????????????????????????????????????????
? Preferences NO guardadas
? Va a Bienvenida
? Login manual requerido
Observaciones: _________________________

???????????????????????????????????????????
PRUEBA 3: Cerrar sesión manual
???????????????????????????????????????????
? Preferences limpiadas
? Login automático NO funciona
? Va a Bienvenida
Observaciones: _________________________

???????????????????????????????????????????
PRUEBA 4: Campos prellenados
???????????????????????????????????????????
? Usuario prellenado
? CheckBox marcado
? Contraseña vacía
Observaciones: _________________________

???????????????????????????????????????????
PRUEBA 5: Usuario desactivado
???????????????????????????????????????????
? Detecta usuario inválido
? Limpia preferences
? Va a Bienvenida
Observaciones: _________________________

???????????????????????????????????????????
RESULTADO FINAL
???????????????????????????????????????????
? EXITOSO
? FALLIDO

Descripción: ____________________________
____________________________________________

???????????????????????????????????????????
```

---

¡Buena suerte con las pruebas! ??
