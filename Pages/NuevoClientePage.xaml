<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:App_CrediVnzl.ViewModels"
             x:Class="App_CrediVnzl.Pages.NuevoClientePage"
             Title=""
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header azul con degradado -->
        <Grid Grid.Row="0">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#2563EB" Offset="0.0" />
                    <GradientStop Color="#1D4ED8" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>
            <Grid Padding="20,40,20,20" ColumnDefinitions="Auto,*" ColumnSpacing="15">
                <Button Grid.Column="0"
                        Text="←"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="24"
                        FontAttributes="Bold"
                        WidthRequest="40"
                        HeightRequest="40"
                        CornerRadius="20"
                        Command="{Binding CancelarCommand}"
                        VerticalOptions="Center" />
                
                <Label Grid.Column="1"
                       Text="{Binding PageTitle}"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center" />
            </Grid>
        </Grid>

        <!-- Contenido principal con fondo blanco/gris -->
        <ScrollView Grid.Row="1" BackgroundColor="#F5F5F5">
            <VerticalStackLayout Padding="20" Spacing="20">

                <!-- Nombres -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Nombres *"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333" />
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="0"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Padding="15,12">
                            <Label Grid.Column="0"
                                   Text="●"
                                   FontSize="20"
                                   TextColor="#2196F3"
                                   VerticalOptions="Center" />
                            <Entry Grid.Column="1"
                                   Placeholder="Ingrese los nombres"
                                   Text="{Binding Cliente.Nombres}"
                                   BackgroundColor="Transparent"
                                   FontSize="16"
                                   TextColor="#333333"
                                   PlaceholderColor="#999999" />
                        </Grid>
                    </Frame>
                </VerticalStackLayout>

                <!-- Apellidos -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Apellidos *"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333" />
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="0"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Padding="15,12">
                            <Label Grid.Column="0"
                                   Text="●"
                                   FontSize="20"
                                   TextColor="#2196F3"
                                   VerticalOptions="Center" />
                            <Entry Grid.Column="1"
                                   Placeholder="Ingrese los apellidos"
                                   Text="{Binding Cliente.Apellidos}"
                                   BackgroundColor="Transparent"
                                   FontSize="16"
                                   TextColor="#333333"
                                   PlaceholderColor="#999999" />
                        </Grid>
                    </Frame>
                </VerticalStackLayout>

                <!-- Teléfono / WhatsApp -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Teléfono / WhatsApp *"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333" />
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="0"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <Grid ColumnDefinitions="Auto,Auto,*" ColumnSpacing="12" Padding="15,12">
                            <Label Grid.Column="0"
                                   Text="☏"
                                   FontSize="20"
                                   TextColor="#4CAF50"
                                   VerticalOptions="Center" />
                            <Label Grid.Column="1"
                                   Text="+51"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#333333"
                                   VerticalOptions="Center" />
                            <Entry Grid.Column="2"
                                   Placeholder="999 999 999"
                                   Text="{Binding NumeroTelefono}"
                                   Keyboard="Telephone"
                                   BackgroundColor="Transparent"
                                   FontSize="16"
                                   TextColor="#333333"
                                   PlaceholderColor="#999999"
                                   MaxLength="11" />
                        </Grid>
                    </Frame>
                    <Label Text="Ingrese solo los 9 dígitos del número (el código +51 se agrega automáticamente)"
                           FontSize="11"
                           TextColor="#666666"
                           Margin="5,0,0,0" />
                </VerticalStackLayout>

                <!-- DNI / Carnet de Extranjería -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Seleccione documento *"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333" />
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="15"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <VerticalStackLayout Spacing="10">
                            <!-- Radio buttons en diseño vertical para mejor responsividad -->
                            <RadioButton IsChecked="{Binding IsDniSelected}" 
                                       Content="DNI"
                                       TextColor="#333333"
                                       FontSize="15"
                                       FontAttributes="Bold" />
                            <RadioButton IsChecked="{Binding IsCarnetSelected}" 
                                       Content="Carnet de Extranjería"
                                       TextColor="#333333"
                                       FontSize="15"
                                       FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>

                <!-- Número de Documento -->
                <VerticalStackLayout Spacing="8">
                    <Label FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333">
                        <Label.Text>
                            <MultiBinding StringFormat="{}{0} *">
                                <Binding Path="Cliente.TipoDocumento" />
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="0"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Padding="15,12">
                            <Label Grid.Column="0"
                                   Text="▣"
                                   FontSize="20"
                                   TextColor="#9C27B0"
                                   VerticalOptions="Center" />
                            <Entry Grid.Column="1"
                                   BackgroundColor="Transparent"
                                   FontSize="16"
                                   TextColor="#333333"
                                   PlaceholderColor="#999999"
                                   Text="{Binding Cliente.NumeroDocumento}">
                                <Entry.Placeholder>
                                    <MultiBinding StringFormat="Ingrese el número de {0}">
                                        <Binding Path="Cliente.TipoDocumento" />
                                    </MultiBinding>
                                </Entry.Placeholder>
                            </Entry>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>

                <!-- Recibo de Luz o Agua -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Recibo de Luz o Agua"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333" />
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="15"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <VerticalStackLayout Spacing="10">
                            <Button Text="{Binding TextoBotonImagen}"
                                    BackgroundColor="#FF9800"
                                    TextColor="White"
                                    FontSize="14"
                                    CornerRadius="6"
                                    Command="{Binding SeleccionarImagenCommand}" />
                            
                            <StackLayout Orientation="Horizontal" 
                                       Spacing="10" 
                                       IsVisible="{Binding TieneImagenRecibo}">
                                <Button Text="Ver Imagen"
                                        BackgroundColor="#4CAF50"
                                        TextColor="White"
                                        FontSize="12"
                                        CornerRadius="6"
                                        Command="{Binding VerImagenCommand}"
                                        HorizontalOptions="FillAndExpand" />
                                <Button Text="Eliminar"
                                        BackgroundColor="#F44336"
                                        TextColor="White"
                                        FontSize="12"
                                        CornerRadius="6"
                                        Command="{Binding EliminarImagenCommand}"
                                        HorizontalOptions="FillAndExpand" />
                            </StackLayout>
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>

                <!-- Aval -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Aval (Opcional)"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333" />
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="15"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <VerticalStackLayout Spacing="15">
                            <!-- Selector de tipo de aval - Diseño responsivo -->
                            <VerticalStackLayout Spacing="8">
                                <RadioButton IsChecked="{Binding UsarClienteComoAval}" 
                                           Content="Cliente Existente"
                                           TextColor="#333333"
                                           FontSize="15"
                                           FontAttributes="Bold" />
                                <RadioButton IsChecked="{Binding UsarDatosManualAval}" 
                                           Content="Datos Nuevos"
                                           TextColor="#333333"
                                           FontSize="15"
                                           FontAttributes="Bold" />
                            </VerticalStackLayout>

                            <!-- Picker para cliente existente -->
                            <Picker Title="Seleccionar cliente como aval"
                                    ItemsSource="{Binding ClientesParaAval}"
                                    ItemDisplayBinding="{Binding NombreCompleto}"
                                    SelectedItem="{Binding AvalClienteSeleccionado}"
                                    IsVisible="{Binding UsarClienteComoAval}"
                                    TextColor="#333333"
                                    BackgroundColor="Transparent" />

                            <!-- Campos para datos manuales del aval -->
                            <VerticalStackLayout Spacing="10" IsVisible="{Binding UsarDatosManualAval}">
                                <Entry Placeholder="Nombres del aval"
                                       Text="{Binding Cliente.AvalNombres}"
                                       BackgroundColor="Transparent"
                                       FontSize="14"
                                       TextColor="#333333"
                                       PlaceholderColor="#999999" />
                                <Entry Placeholder="Apellidos del aval"
                                       Text="{Binding Cliente.AvalApellidos}"
                                       BackgroundColor="Transparent"
                                       FontSize="14"
                                       TextColor="#333333"
                                       PlaceholderColor="#999999" />
                                <Entry Placeholder="Teléfono del aval"
                                       Text="{Binding Cliente.AvalTelefono}"
                                       Keyboard="Telephone"
                                       BackgroundColor="Transparent"
                                       FontSize="14"
                                       TextColor="#333333"
                                       PlaceholderColor="#999999" />
                                <Entry Placeholder="Documento del aval"
                                       Text="{Binding Cliente.AvalNumeroDocumento}"
                                       BackgroundColor="Transparent"
                                       FontSize="14"
                                       TextColor="#333333"
                                       PlaceholderColor="#999999" />
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>

                <!-- Observaciones -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Observaciones"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#333333" />
                    <Frame BackgroundColor="White"
                           CornerRadius="8"
                           Padding="0"
                           HasShadow="True"
                           BorderColor="Transparent">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Padding="15,12">
                            <Label Grid.Column="0"
                                   Text="◐"
                                   FontSize="20"
                                   TextColor="#607D8B"
                                   VerticalOptions="Start"
                                   Margin="0,5,0,0" />
                            <Editor Grid.Column="1"
                                    Placeholder="Ingrese observaciones adicionales..."
                                    Text="{Binding Cliente.Observaciones}"
                                    BackgroundColor="Transparent"
                                    FontSize="14"
                                    TextColor="#333333"
                                    PlaceholderColor="#999999"
                                    HeightRequest="80"
                                    AutoSize="TextChanges" />
                        </Grid>
                    </Frame>
                </VerticalStackLayout>

                <!-- Botón Guardar Cliente -->
                <Button Text="Guardar Cliente"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        FontSize="16"
                        FontAttributes="Bold"
                        CornerRadius="12"
                        HeightRequest="50"
                        Margin="0,30,0,50"
                        Command="{Binding GuardarCommand}" />

            </VerticalStackLayout>
        </ScrollView>

    </Grid>
</ContentPage>
